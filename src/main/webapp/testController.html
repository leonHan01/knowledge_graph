<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <title>han's pic</title>
    <style>
        #div1 {
            width: 1950px;
            height: 140px;
            background: green;
            position: absolute;
            left: -1950px;
        }

        #div1 span {
            position: absolute;
            width: 20px;
            height: 60px;
            line-height: 20px;
            background: blue;
            right: -20px;
            top: 70px;
        }
    </style>
</head>
<body style="background-color: #555555">
<!--<input type="text" id="aaa">条件筛选</input>-->
<button onclick="startQuery()" style="width:460px;height:220px;font-size:70px;">启动/刷新</button>

<button onclick="likePic(5)" style="width:460px;height:220px;font-size:80px;">5分</button>
<button onclick="likePic(4)" style="width:460px;height:220px;font-size:80px;">4分</button>
<button onclick="likePic(3)" style="width:460px;height:220px;font-size:80px;">3分</button>
<button onclick="likePic(2)" style="width:460px;height:220px;font-size:80px;">2分</button>
<button onclick="likePic(1)" style="width:460px;height:220px;font-size:80px;">1分</button>

<button onclick="unlikePic()" style="width:920px;height:220px;font-size:60px;"> 不喜欢！ next!</button>


<div id="div1">
    <span>玩命缓冲</span>
</div>
<script>
    var picId;

    function getJSON(url) {
        return new Promise(function (resolve, reject) {
            var xhr = new XMLHttpRequest();
            xhr.open('get', url, true);
            xhr.responseType = 'json';
            xhr.dataType = 'JSONP',  // 处理Ajax跨域问题
                xhr.onload = function () {
                    var status = xhr.status;
                    if (status == 200) {
                        console.log('成功：' + xhr.response);
                        resolve(xhr.response);
                    } else {
                        reject(status);
                    }
                };
            xhr.send();
        });
    }

    function startHttpQuery() {
        var url = "http://127.0.0.1:8080/getPic" + "?type=goEasy";
        getJSON(url).then(function (data) {
                picId = data.picId;
            },
            function (status) {
                alert('Something went wrong.');
            });
    }


    function likePic(score) {
        startMove(0);
        var url = "http://127.0.0.1:8080/like";
        if (null != picId) {
            //get方法的查询参数设置
            url = url + "?picId=" + picId + "&score=" + score + "&type=goEasy";
        }
        getJSON(url).then(function (data) {
                picId = data.picId;
                startMove(-1950);
            },
            function (status) {
                alert('Something went wrong.');
            });
    }


    function unlikePic() {
        startMove(0);
        var url = "http://127.0.0.1:8080/unlike";
        if (null != picId) {
            //get方法的查询参数设置
            url = url + "?picId=" + picId + "&type=goEasy";
        }
        getJSON(url).then(function (data) {
                picId = data.picId;
                startMove(-1950);
            },
            function (status) {
                alert('Something went wrong.');
            });
    }

    function startQuery() {
        startHttpQuery();
    }

    var timer = null;

    function startMove(iTarget) {
        var oDiv = document.getElementById('div1');

        clearInterval(timer);
        timer = setInterval(function () {
            var speed = 0;

            if (oDiv.offsetLeft > iTarget) {
                speed = -50;
            }
            else {
                speed = 10;
            }

            if (oDiv.offsetLeft == iTarget) {
                clearInterval(timer);
            }
            else {
                oDiv.style.left = oDiv.offsetLeft + speed + 'px';
            }
        }, 30);
    }
</script>
</body>
</html>